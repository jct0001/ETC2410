---
title: "Group Assignment 1"
author: "Alex Wong, Chelaka Paranahewa, Harjot Channa, Jonas Tiong"
output: pdf_document
---

```{r, echo = FALSE, include = FALSE}
library(tidyverse)
library(dplyr)
library(broom)
library(tidymodels)
library(knitr)
library(psych)
library(car)
```

```{r importing data, echo = FALSE, include = FALSE, warning=FALSE, error=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)
# setwd("C:/Users/chela/GitHub Repo/ETC2410/")
dat <- read_csv("data_q1_ass1_s1_22.csv")
```

# Question 1

### Part A

#### Section i 
Histogram of `logsal`

```{r, warning = FALSE, error = FALSE, echo = FALSE}
dat %>% ggplot(aes(x = logsal)) +
    geom_histogram(aes(y = after_stat(density)),
        bins = 20
    ) +
    geom_density() +
    labs(
        x = "logsal",
        y = "Density",
        title = "Histogram of logsal"
    )
```


#### Section ii
```{r, warning = FALSE, error = FALSE, echo = FALSE}
logsal_stat <- dat$logsal %>%
    describe() %>%
    as_tibble() %>%
    select(c(n, mean, median, min, max, sd, skew, kurtosis))

kable(logsal_stat)
```
As the mean is greater than the median, the distribution is positively skewed indicating that there are high valued outliers (those earning high annual wages). Since the skewness is 0.99, we can say that this distribution is moderately skewed.

On average, an individual in this bank will have a log of annual salary of around 10.36 or, in other words, an annual salary of around $e^{10.36} = 31,470.09$. The maximum annual salary, empirically, is around $e^{11.81} = 135,000.00$ and the lowest salary in the bank is around $e^{9.66} = 15,750.00$ That is a difference of around $119,250.00$.

### Part B

#### Section i

Scatterplot of `logsal` and `race`
```{r, warning = FALSE, error = FALSE, echo = FALSE, fig.align='center'}
dat %>% ggplot(aes(x = race, y = logsal)) +
    geom_point() +
    # scale_y_continuous(breaks = c(0, 1), minor_breaks = NULL) +
    xlim(-1, 2) +
    labs(title = "logsal v race")
```

\begin{align*}
    \text {race} &: \text {1 if individual i belongs to an ethnic minority, 0 otherwise}\\
    \text {logsal} &: \text {the natural log of individual i’s annual salary}\\
\end{align*}

#### Section ii  

Recall from part (a)ii) that the mean of `logsal` was around 10.36. From the scatterplot it is evident that in this bank, an individual who does not belong to an ethnic minority earns in a wide range of salaries from slightly below to 10.0 to slightly above 11.0 (as per where all the data points are clustered). In contrast, for an individual who does belong to an ethnic minority this is range is far smaller, somewhere slightly below 10.0 to around 10.5. Hence, the gap from the mean wage of 10.36 is larger for non-minorities which may suggest larger mobility for this category of employees which would be indicative of racial discrimination.

### Part C

#### Section i

\begin{align*}
    \widehat{logsal} &= \underset{(0.020)}{10.396} - \underset{(0.043)}{0.180} \ race \\
    R^2 &: 0.035414 \\
    n &: 474 \\
\end{align*}

```{r, warning = FALSE, error = FALSE, echo = FALSE}

# OLS regression
fit1 <- lm(logsal ~ race, data = dat)
# fit1 %>% summary()
```

#### Section ii

Our null hypothesis is that race has no effect on an individual's annual (log of their) salary in this bank ($\beta_{1} = 0$). The alternative hypothesis is that race has an effect ($\beta_{1} \neq 0$). 
```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_1 <- 0.05

# test statistic
tstat1 <- coef(summary(fit1))[2, "Estimate"] /
    coef(summary(fit1))[2, "Std. Error"]
# ~t(472)

# critical value under the null
tcrit1 <- qt(1 - alpha_1 / 2, 472)

# decision
# abs(tstat1) > (tcrit1)
# make something that says reject H0
```


\begin{align*}
    H_0 &: \beta_1 = 0 \\
    H_1 &: \beta_1 \neq 0 \\
    \text {Significance Level} &: \alpha = 0.05 \\
    \text {Test stat and null dist} &: \frac{\hat \beta_1}{se(\hat \beta_1)} \sim t_{n-k-1} = t_{472} \\
    t_{calc} &= `r abs(tstat1)` \\
    t_{crit} &= `r tcrit1` \\
    \text {Decision rule} &: \text {reject $H_0$ if $|t_{calc}| > t_{crit}$} \\
    \text {Decision} &: \text {Since `r abs(tstat1)` > `r tcrit1`, reject $H_0$} \\
\end{align*}

In conclusion, at 0.05 level of significance, we reject the null hypothesis that race has no effect on (the log of) an individual's annual salary in favour of the alternative hypothesis race has an effect.

#### Section iii  

$\hat{\beta_{1}}$ measures the average difference in the log of an individual's annual salary in the bank (thus proportionate difference) between someone who belongs to an ethnic minority and someone who does not.

Hence, the average difference, according to our model, in an individual's annual salary between someone who belongs to an ethnic minority is $e^{-0.180}$ times the annual salary of someone who does not belong to an ethnic minority. Or, in other words, the average difference of the log annual salary is that someone who does not belong to an ethnic minority earns $-0.180$ more than someone who is part of ethnic minority.

#### Section iv  

This model does not provide conclusive evidence of racial discrimination in salaries paid by the bank. This is because it does not account for (condition on) confounding variables - variables that causally effect an individual's annual salary and whether they belong to an ethnic minority. For example, an individual's level of education may be a variable of interest; the individual may be an immigrant to which US' immigration policy and its skill stream for accepting immigrants (based on education) may decide whether or not someone (in America) belongs to an ethnic minority. And, for an individual's annual salary, may be effected by if the company values (and thus willing to pay wages that are higher) for someone based on the education that they have. 

#### Section v  

As the coefficient of determination is around $R^2 = 0.035$, this means that around 3.5 per cent of the sample variation in the log of an individual's annual salary is explained by race in this bank. Hence, this model is a very low fit for describing what variables effect an individual's annual salary, where the remaining 96.5 per cent may be caused be unaccounted for variables like education (as aforementioned) or inherent variability. 

```{r, warning = FALSE, error = FALSE}

SSR1 <- sum(resid(fit1)^2)
SST1 <- sum((dat$logsal - mean(dat$logsal))^2)

R2_1 <- 1 - (SSR1) / SST1
R2_1
```

#### Section vi  

$\beta_{0}$ measures the conditional mean of the log of an individual's annual salary in this bank who does not belong to an ethnic minority. This value is 10.396.
In other words, the conditional mean of an individual's annual salary who is not part of of ethnic minority is $e^{10.396}$.

#### Section vii

```{r, warning = FALSE, error = FALSE}
LB1 <- coef(summary(fit1))[1, "Estimate"] -
    coef(summary(fit1))[1, "Std. Error"] * qt(1 - alpha_1 / 2, 472)

UP1 <- coef(summary(fit1))[1, "Estimate"] +
    coef(summary(fit1))[1, "Std. Error"] * qt(1 - alpha_1 / 2, 472)

confint1 <- cbind(LB1, UP1) %>%
    as_tibble() %>%
    rename(
        "2.5 %" = LB1,
        "97.5 %" = UP1
    )
```
\begin{align*}
    \text {Confidence interval} &: (\hat \beta_0 - t_{472@0.025} se(\hat \beta_0), \hat \beta_0 + t_{472@0.025} se(\hat \beta_0))\\
    &: (`r coef(summary(fit1))[1, "Estimate"]` - `r qt(1 - alpha_1 / 2, 472)` \times `r coef(summary(fit1))[1, "Std. Error"]`, `r coef(summary(fit1))[1, "Estimate"]` + `r qt(1 - alpha_1 / 2, 472)` \times `r coef(summary(fit1))[1, "Std. Error"]`) \\
    &: (`r LB1`, `r UP1`)
\end{align*}

```{r}
# confint1 %>% kable()

# confint(fit1, level = 0.95)
```

#### Section viii  

We are 95 per cent confident, on average, that the population mean of the the log of an individual's annual salary in this bank for someone who does not belong to an ethnic minority is between 10.356 and 10.436. That is, 95 per cent of the time, the interval between $e^{10.356}$ and $e^{10.436}$ will contain the population mean of an individual's annual salary in this bank for someone who does not belong to a ethnic minority. 

#### Section ix  

Since $\beta_{0} = 0$, in a hypothesis test of individual significance at  0.05, does not fall within the 95 per cent confidence interval ${10.356, 10.436}$ we conclude that $\hat{\beta_{0}}$ is statistically significant. That is, we reject the null hypothesis that $\beta_{0} = 0$ for the alternative hypothesis that $\beta_{0} \neq 0$.

### Part D

#### Section i

\begin{align*}
    \widehat{logsal} &= \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} \ educ \ + \ \underset{(0.045)}{0.601} \ logssal \ + \ \underset{(0.019)}{0.061} \  gender \ - \ \underset{(0.019)}{0.043} \ race \ + \underset{(0.016)}{0.121}  \ jobcat \\
    R^2 &: 0.826101 \\
    n &: 474 \\
\end{align*}


```{r, warning = FALSE, error = FALSE}
# OLS regression
fit2 <- lm(logsal ~ educ + logssal + gender + race + jobcat, data = dat)
# fit2 %>% summary()
```

#### Section ii  

A regressor is individually insignificant at 0.01 level of significance if its p-value is larger than 0.01, $\textrm{p-value} > 0.01$.
So according to our model only race is individually insignificant at this level as $\textrm{p-value}_{race} = 0.027 > 0.01$.

#### Section iii

```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_2 <- 0.05

# unrestricted model
fit2.UR <- lm(logsal ~ educ + logssal + gender + race + jobcat, data = dat)
# fit2.UR %>% summary()

# restricted model
fit2.R <- lm(logsal ~ logsal, data = dat)
# fit2.R %>% summary()

# Sum of squared residuals
SSR2.UR <- sum(resid(fit2.UR)^2)
SSR2.R <- sum(resid(fit2.R)^2)

# degrees of freedom
DF2_num <- df.residual(fit2.R) - df.residual(fit2.UR) # no. of restrictions = 5
DF2_denom <- df.residual(fit2.UR) # degrees of freedom of UR linear model = 468

# test statistic
tstat2 <- ((SSR2.R - SSR2.UR) / DF2_num) / ((SSR2.UR) / DF2_denom)
# ~ F(5, 468)

# critical value
fcrit2 <- qf(1 - alpha_2 / 2, DF2_num, DF2_denom)

# decision
# tstat2 > fcrit2
```

\begin{align*}
    H_0 &: \beta_1 = \beta_2 = \beta_3 = \beta_4 = \beta_5 = 0 \\
    H_1 &: \underset{i \in \{1, 2, 3, 4, 5\}}{\exists} {\beta_i} \neq 0 \text {at least one regressor coef is zero}\\
    \text {Significance Level} &: \alpha = 0.05 \\
    \text {Unresticted Model} &: \widehat{logsal} = \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} educ + \underset{(0.045)}{0.601} logssal + \underset{(0.019)}{0.061} gender - \underset{(0.019)}{0.043} race + \underset{(0.016)}{0.121} jobcat\\
    \text {Resticted Model} &: \widehat{logsal} = \underset{(0.018)}{10.357}\\
    \text {Test stat and null dist} &: \frac{(SSR_R - SSR_{UR})}{SSR_{UR}} \frac{(n-k-1)}{q} \sim F_{(q, n-k-1)} = F_{5, 468} \\
    F_{calc} &= `r tstat2` \\
    F_{crit} &= `r fcrit2` \\
    \text {Decision rule} &: \text {reject $H_0$ if $t_{calc} > F_{crit}$} \\
    \text {Decision} &: \text {Since `r tstat2` > `r fcrit2`, reject $H_0$} \\
\end{align*}

In conclusion, at 0.05 level of significance, we reject the null hypothesis that an individual's number of years of education, their gender, the job category within the bank, their log of their starting annual salary, and if they belong to an ethnic minority are jointly insignificant in effecting (the log of an) individual's annual salary in favour of the alternative hypothesis that at least one of these variables are significant.

#### Section iv  

$\hat{\beta_{4}}$ measures the average difference in the log of an individual's annual salary in the bank (thus proportionate difference) between someone who belongs to an ethnic minority and someone who does not, controlling for the the number of years of education, the gender, the job category within the bank, and the log of an individual's starting salary.

Hence *this* average difference is $-0.043$; someone who does not belong to an ethnic minority, ceteris paribus, earns $0.043$ more in annual log salary than someone does. In other words, for an individual who belongs to an ethnic minority, he/she earns $e^{-0.043}$ times the annual salary of someone who does not belong an ethnic minority, on average, ceteris paribus.

#### Section v

```{r, warning = FALSE, error = FALSE}
coef(summary(fit2))[4, "Estimate"] - coef(summary(fit2))[5, "Estimate"]
```

***MATHSPEAK LATER***

$\hat{\beta_{3}} - \hat{\beta_{4}} = 0.103$ does not have a meaningful interpretation. This is because $\hat{\beta_{3}}$ is the conditional mean of the log of an individual's annual salary given that they are male and ceteris paribus minus the conditional mean of the log of an individual's annual salary given that they are female and ceteris paribus. $\hat{\beta_{4}}$ is the conditional mean of  the log an individual's annual salary given that they belong to an ethnic minority and ceteris paribus minus the conditional mean of the log of an individual's annual salary given that the do not belong to an ethnic minority and ceteris paribus. Hence, the difference between $\hat{\beta_{3}}$ and $\hat{\beta_{4}}$ is the sum of the conditional mean of an individual's annual salary given that they are male, ceteris paribus (including one's racial status), plus the salary given that they are not part of the ethnic minority, ceteris paribus  (including one's gender), minus the salary given that they are female, ceteris paribus (including one's racial status), minus the salary given that they are part of an ethnic minority, ceteris paribus (including one's gender). The fact that this sum of different means is conditional on different set of variables makes any descriptive application inapplicable to the bank.

#### Section vi  

It is likely that this model does provide conclusive evidence of racial discrimination in salaries paid by the bank, as per the individual significance of the regression coefficient for `race` and the joint significance of all regressors. This is because the model takes into account possible confounding variables to `race` and `logsal` — years of education, one's gender, the job category, and the (log of) starting salary — which would allow us to make causal statements about an individual's racial status on the (log of their) annual salary. In other words, we are unlikely to have committed **omitted variable bias** in this model by our specification of variables.

#### Section vii  

The new model has $R^{2} = 0.826$, meaning around 82.6 per cent of the sample variation in the log of an individual's annual salary is explained by the independent variables. This is a much better comparison to the old model where only 3.5 per cent was explained by the independent variables, leaving much variation unexplained (about a $(0.826 - 0.035) \times 100\% = 79.1 \%$  difference). 

Moreover, given that the variance inflation factor (VIF) is not more than 10, which would be indicative of high correlation between regressors, but rather very small at below 2 for each save `logssal` (at around 4.21), this suggests that our new model has not overspecified and that this $R^{2}$ is not high largely because of adding more variables.

```{r, warning = FALSE, error = FALSE, echo = FALSE}
cbind(
    tibble("Model" = c("Old", "New")),
    tibble(
        "R-Squared" =
            c(summary(fit1)$r.squared, summary(fit2)$r.squared)
    )
) %>% kable()

vifout <- vif(fit2) %>%
    as_tibble() %>%
    rename("VIF" = value)
tibble("Regressor" = c("educ", "logssal", "gender", "race", "jobcat")) %>%
    cbind(vifout) %>%
    kable()
```

### Part E

We are working with the same model prior:

\begin{align*}
    \widehat{logsal} &= \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} \ educ \ + \ \underset{(0.045)}{0.601} \ logssal \ + \ \underset{(0.019)}{0.061} \  gender \ - \ \underset{(0.019)}{0.043} \ race \ + \underset{(0.016)}{0.121}  \ jobcat \\
    R^2 &: 0.826101 \\
    n &: 474 \\
\end{align*}

Our null hypothesis is that an individual's gender and race (whether they belong to an ethnic minority) has no effect on the annual (log of their) salary in this bank ($\beta_3 = \beta_4 = 0$). The alternative hypothesis is that it does have an effect ($\beta_3$ and/or $\beta_4$ is non-zero).

```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_3 <- 0.1

# unrestricted model
fit3.UR <- lm(logsal ~ educ + logssal + gender + race + jobcat, data = dat)

# restricted model
fit3.R <- lm(logsal ~ educ + logssal + jobcat, data = dat)

# fit3.UR %>% summary()
# fit3.R %>% summary()

# Sum of squared residuals
SSR3.UR <- sum(resid(fit3.UR)^2)
SSR3.R <- sum(resid(fit3.R)^2)

# degrees of freedom
DF3_num <- df.residual(fit3.R) - df.residual(fit3.UR) # no. of restrictions = 2
DF3_denom <- df.residual(fit3.UR) # degrees of freedom of UR linear model = 468

# test statistic
tstat3 <- ((SSR3.R - SSR3.UR) / DF3_num) / ((SSR3.UR) / DF3_denom)
# ~ F(2, 468)

# critical value
fcrit3 <- qf(1 - alpha_3 / 2, DF3_num, DF3_denom)

# decision
# tstat3 > fcrit3
```


\begin{align*}
    H_0 &: \beta_3 = \beta_4 = 0 \\
    H_1 &: \underset{i \in \{3, 4\}}{\exists} {\beta_i} \neq 0 (\beta_3 \text {and/or} \beta_4 is non zero)\\
    \text {Significance Level} &: \alpha = 0.1 \\
    \text {Unresticted Model} &: \widehat{logsal} = \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} educ +\underset{(0.045)}{0.601} logssal + \underset{(0.019)}{0.061} gender - \underset{(0.019)}{0.043} race + \underset{(0.016)}{0.121} jobcat\\
    \text {Resticted Model} &: \widehat{logsal} = \underset{(0.356)}{3.439} + \underset{(0.004)}{0.0241} educ + \underset{(0.041)}{0.665} logssal + \underset{(0.016)}{0.117} jobcat\\
    \text {Test stat and null dist} &: \frac{(SSR_R - SSR_{UR})}{SSR_{UR}} \frac{(n-k-1)}{q} \sim F(q, n-k-1) = F(2, 468) \\
    F_{calc} &= `r tstat3` \\
    F_{crit} &= `r fcrit3` \\
    \text {Decision rule} &: \text {reject $H_0$ if $F_{calc} > F_{crit}$} \\
    \text {Decision} &: \text {Since `r tstat3` > `r fcrit3`, reject $H_0$} \\
\end{align*}
In conclusion, at 0.05 level of significance, we reject the null hypothesis that an individual's gender and whether they belong to ethnic minority has no effect on the (log of their) annual salary in favour of the alternative hypothesis that their gender and/or their race does effect the individual's (log of their) annual salary.

### Part F

#### Section i  

Given that 
$$
\mathbb{E}[logsal \mid educ, logssal, gender, race, jobcat] = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat
$$
then our estimated conditional mean has form:
$$
\hat{\beta_{0}} + \hat{\beta_{1}} \ educ + \hat{\beta_{2}} \ logssal + 
\hat{\beta_{3}} \ gender + \hat{\beta_{4}} \ race + \hat{\beta_{5}} \ jobcat
$$

For population A, i.e. for the population of female managers with 12 years of education who belong to a racial minority and received a given starting salary, the average `logsal` is:

$$
\begin{aligned}
\mathbb{E}[logsal \mid educ = 12, gender = 0, race = 1, jobcat = 3, logssal] = 
\beta_{0} + \beta_{1}12 + \beta_{2} \ logssal + \beta_{4} + \beta_{5}3 
\\ 
= (\beta_{0} + 12\beta_{1} + \beta_{4} + 3\beta_{5}) + \beta_{2} \ logssal
\end{aligned}
$$

#### Section ii  

Likewise, for population B, i.e. for the population of male managers with 11 years of education who are not members of a ethnic minority and receives the same starting salary as the individuals in population A, the average `logsal` is:

$$
\begin{aligned}
\mathbb{E}[logsal \mid educ = 11, gender = 1, race = 0, jobcat = 3, logssal] = 
\beta_{0} + \beta_{1}11 + \beta_{2} \ logssal + \beta_{3} + \beta_{5}3 
\\ 
= (\beta_{0} + 11\beta_{1} + \beta_{3} + 3\beta_{5}) + \beta_{2} \ logssal
\end{aligned}
$$

#### Section iii  

Given the null hypothesis that the average `logsal` of population A is equal to that of population B $\mathbb{E}[logsal \mid educ = 12, gender = 0, race = 1, jobcat = 3, logssal] = \mathbb{E}[logsal \mid educ = 11, gender = 1, race = 0, jobcat = 3, logssal]$, it follows that:

$\mathbb{E}[logsal \mid educ = 12, gender = 0, race = 1, jobcat = 3, logssal] - \mathbb{E}[logsal \mid educ = 11, gender = 1, race = 0, jobcat = 3, logssal] = 0$

$(\beta_{0} + 12\beta_{1} + \beta_{4} + 3\beta_{5}) + \beta_{2} \ logssal - (\beta_{0} + 11\beta_{1} + \beta_{3} + 3\beta_{5}) - \beta_{2} \ logssal = \beta_{1} + \beta_{4} - \beta_{3} = 0$

So the restriction that follows from the null hypothesis is that $\beta_{1} + \beta_{4} = \beta_{3}$. The negation of this statement is that $\beta_{1} + \beta_{4} \neq \beta_{3}$ which is the alternative hypothesis, where the average `logsal` of population A is not equal to that of population B.

#### Section iv  

Under the null hypothesis, $\beta_{1} + \beta_{4} = \beta_{3}$. So, rearranging to get $\beta_{1} = \beta_{3} - \beta_{4}$ we can substitute this into our unrestricted model (the population model):

$$
\mathbb{E}[logsal \mid educ, logssal, gender, race, jobcat] = \beta_{0} + 
\beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race 
+ \beta_{5} \ jobcat
$$

to get:

$$
\begin{aligned}
\beta_{0} + (\beta_{3} - \beta_{4}) \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat 
\\ 
= \beta_{0} + \beta_{3} \ educ - \beta_{4} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat
\\ 
= \beta_{0} + \beta_{2}\ logssal + \beta_{3} (educ + \ gender) +  \beta_{4}(race \ - \ educ) + \beta_{5} \ jobcat 
\end{aligned}
$$
let $U = educ + gender$  and $V = race - educ$, so

$$
\beta_{0} + \beta_{2} \ logssal + \beta_{3}U + \beta_{4}V + \beta_{5} \ jobcat
$$

This expression is our restricted model. We will use these two models for our F-test when we come to test the null hypothesis that $\beta_{1} + \beta_{4} = \beta_{3}$ (tantamount to holding that the two populations A and B have the same `logsal`) against the alternative hypothesis that $\beta_{1} + \beta_{4} \neq \beta_{3}$ (that the two populations A and B do not have the same average `logsal`).

#### Section v

```{r, warning = FALSE, error = FALSE}
# fit4.UR <- lm(logsal ~ educ + logssal + gender + race + jobcat, data = dat)

U <- dat$educ + dat$gender
V <- dat$race - dat$educ

fit4.R <- lm(logsal ~ logssal + U + V + jobcat, data = dat)

# fit4.R %>% summary()
```

So our restricted model is:
$$
\widehat{logsal} = \underset{(0.371)}{3.685} + \underset{(0.043)}{0.636} \ logssal + \underset{(0.012)}{0.023}U  - \underset{(0.012)}{0.003}V + \underset{(0.016)}{0.119} jobcat
$$

#### Section vi

```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_4 <- 0.1

# unrestricted model
fit4.UR <- lm(logsal ~ educ + logssal + gender + race + jobcat, data = dat)

# Sum of squared residuals
SSR4.UR <- sum(resid(fit4.UR)^2)
SSR4.R <- sum(resid(fit4.R)^2)

# degrees of freedom
DF4_num <- df.residual(fit4.R) - df.residual(fit4.UR) # no. of restrictions = 1
DF4_denom <- df.residual(fit4.UR) # degrees of freedom of UR linear model = 468

# test statistic
tstat4 <- ((SSR4.R - SSR4.UR) / DF4_num) / ((SSR4.UR) / DF4_denom)
# ~ F(1, 468)

# critical value
fcrit4 <- qf(1 - alpha_4 / 2, DF4_num, DF4_denom)

# decision
# tstat4 > fcrit4
```

NOTE TO CHANGE THIS LATEX AS THIS ERRONEOUS FROM PREVIOUS MISTAKE!
\begin{align*}
    H_0 &: \beta_1 + \beta_4 = \beta_3\\
    H_1 &: \beta_1 + \beta_4 \neq \beta_3\\
    \text {Significance Level} &: \alpha = 0.1 \\
    U &: educ + gender\\
    V &: race - educ\\
    \text {Unresticted Model} &: \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} educ + \underset{(0.045)}{0.601} logssal + \underset{(0.019)}{0.061} gender - \underset{(0.019)}{0.043} race + \underset{(0.016)}{0.121} jobcat\\
    \text {Resticted Model} &: \widehat{logsal} = \underset{(0.164)}{8.282} - \underset{(0.020)}{0.120}U + \underset{(0.019)}{0.160} gender - \underset{(0.019)}{0.160}V + \underset{(0.015)}{0.227} jobcat\\
    \text {Test stat and null dist} &: \frac{(SSR_R - SSR_{UR})}{SSR_{UR}} \frac{(n-k-1)}{q} \sim F(q, n-k-1) = F(2, 468) \\
    F_{calc} &= `r tstat4` \\
    F_{crit} &= `r fcrit4` \\
    \text {Decision rule} &: \text {reject $H_0$ if $F_{calc} > F_{crit}$} \\
    \text {Decision} &: \text {Since `r tstat4` > `r fcrit4`, reject $H_0$} \\
\end{align*}
In conclusion, at 0.05 level of significance, we reject the null hypothesis that the average of the `logsalary` for population A is the same population B in favour of the alternative hypothesis that they are not equal. In other words, there is a difference between an individual who is female, a manager, with 12 years of education, belongs to an ethnic minority, and has a starting salary *and* an individual who is male, a manager, has 11 years of education, is not an member of a ethnic minority, and also has a starting salary.

### Part G

#### Section i  

By definition, the racial pay gap for males is:
$$
\mathbb{E}[logsal \mid gender = 1, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 1, race = 0, educ, logssal, jobcat]
$$

Given
$$
\mathbb{E}[logsal \mid educ, logssal, gender, race, jobcat] = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat
$$
it follows that:

$$
\begin{aligned} 
    \mathbb{E}[logsal \mid gender = 1, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 1, race = 0, educ, logssal, jobcat] \\
    = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} + \beta_{4} + \beta_{5} \ jobcat - (\beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} + \beta_{5} \ jobcat) \\ 
    = \beta_{4}\\
\end{aligned}
$$
So the racial pay gap for males is $\beta_{4}$.

#### Section ii  
By definition, the racial pay gap for females is:
$$
\mathbb{E}[logsal \mid gender = 0, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 0, race = 0, educ, logssal, jobcat
$$
Given
$$
\mathbb{E}[logsal \mid educ, logssal, gender, race, jobcat] = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat
$$
it follows that:

$$
\begin{aligned}
    \mathbb{E}[logsal \mid gender = 0, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 0, race = 0, educ, logssal, jobcat] \\ 
    = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{4} + \beta_{5} \ jobcat - (\beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{5} \ jobcat) \\ 
    = \beta_{4}\\
\end{aligned}
$$
So the racial pay gap for females is also $\beta_{4}$.

These results make sense, for another interpretation of $\beta_{4}$ is the partial effect of being in an ethnic minority on the log of an individual's starting salary against not being in an ethnic minority, that is, holding all else constant. Hence, whether or not we are looking at male or female racial pay gap is already accounted for in this model by $\beta_{4}$.

### Part H

#### Section i  

To allow in our model for the racial pay gap to vary by gender, we may introduce the interaction term $race \times gender$, allowing `race` to vary as a function of `gender`. Thus,

$$
\mathbb{E}[logsal \mid educ, logssal, gender, race, jobcat] = \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} \ gender + \beta_{4} \ race + \beta_{5} \ jobcat + \beta_{6} \ race \times gender
$$

#### Section ii  

The racial pay gap for males, controlling for education, starting salary, and job category is:
$$
\mathbb{E}[logsal \mid gender = 1, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 1, race = 0, educ, logssal, jobcat]
$$
According to our new model, this is

$$
\begin{aligned}
\mathbb{E}[logsal \mid gender = 1, race =1, educ, logssal, jobcat] - 
\mathbb{E}[logsal \mid gender = 1, race = 0, educ, logssal, jobcat] 
\\ 
= \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} + \beta_{4} + \beta_{5} \ jobcat + \beta_{6} 
- (\beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{3} + \beta_{5} \ jobcat) 
\\ 
= \beta_{4} + \beta_{6}
\end{aligned}
$$

So *this* racial pay gap for males is equal to $\beta_{4} + \beta_{6}$.

#### Section iii  

The racial pay grap for females, controlling for education, starting salary, and job category is:
$$
\mathbb{E}[logsal \mid gender = 0, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 0, race = 0, educ, logssal, jobcat]
$$
According to our new model, this is

$$
\begin{aligned}
\mathbb{E}[logsal \mid gender = 0, race =1, educ, logssal, jobcat] - \mathbb{E}[logsal \mid gender = 0, race = 0, educ, logssal, jobcat] 
\\ 
= \beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{4} + \beta_{5} \ jobcat
- (\beta_{0} + \beta_{1} \ educ + \beta_{2} \ logssal + \beta_{5} \ jobcat) 
\\ 
= \beta_{4}
\end{aligned}
$$

So *this* racial pay gap for females is equal to $\beta_{4}$.

#### Section iv  

The null hypothesis is that, controlling for education, starting salary, and job category, the racial pay gap for males and females is the same. Hence, from part (h)ii) and part (h)iii) this statement is equivalent to the stating that $\beta_{4} + \beta_{6} = \beta_{4}$ which in other words is to say that $\beta_{6} = 0$.

```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_5 <- 0.1

# OLS regression
fit5 <- lm(logsal ~ educ + logssal + gender + race + jobcat + race * gender,
    data = dat
)

# test statistic
tstat5 <- coef(summary(fit5))[7, "Estimate"] /
    coef(summary(fit5))[7, "Std. Error"]
# ~t(467)

# critical value under the null
tcrit5 <- qt(1 - alpha_5 / 2, 467)

# decision
# abs(tstat5) > tcrit5
```
\begin{align*}
    H_0 &: \beta_6 = 0 \\
    H_1 &: \beta_6 \neq 0 \\
    \text {Significance Level} &: \alpha = 0.1 \\
    \text {Est Reg} &: \underset{(0.390)}{4.026} + \underset{(0.004)}{0.024} educ + \underset{(0.045)}{0.601} logssal + \underset{(0.019)}{0.061} gender - \underset{(0.019)}{0.043} race + \underset{(0.016)}{0.121} jobcat \\
    \text {Test stat and null dist} &: \frac{\hat \beta_1}{se(\hat \beta_1)} \sim t_{n-k-1} = t_{467} \\
    t_{calc} &= `r abs(tstat5)` \\
    t_{crit} &= `r tcrit5` \\
    \text {Decision rule} &: \text {reject $H_0$ if $|t_{calc}| > t_{crit}$} \\
    \text {Decision} &: \text {Since `r abs(tstat5)` > `r tcrit5`, reject $H_0$} \\
\end{align*}
In conclusion, at 0.10 level of significance, we reject the null hypothesis that, controlling for education, starting salary, and job category, the racial pay gap for males and females is the same in favour of the alternative hypothesis that they are not.