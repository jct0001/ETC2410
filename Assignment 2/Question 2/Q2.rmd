---
# title: "ETC2410 Assignment 2"
# author: "Alex Wong, Chelaka Paranahewa, Harjot Channa, Jonas Tiong"

output: 
    pdf_document:
        df_print: kable
        fig_caption: yes
        fig_crop: no
        extra_dependencies: ["mathtools", "amsmath", "flexisym", "breqn"]
    latex_engine: xelatex
mainfont: Times New Roman
fontsize: 12pt
---

# **Question 2 (31 Marks)**

```{r Setup, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}
library(tidyverse)
library(fpp3)
library(knitr)

knitr::opts_chunk$set(
    echo = FALSE,
    warning = FALSE,
    error = FALSE,
    message = FALSE
)

db <- read.csv2(
    file = "Data/HOUSTNSA.csv",
    sep = ","
)

db <- db %>%
    as_tibble() %>%
    mutate(
        DATE = yearmonth(DATE),
        HOUSTNSA = as.numeric(HOUSTNSA)
    ) %>%
    as_tsibble()

db$Jan <- ifelse(month(db$DATE) == 1, 1, 0) # nolint
db$Feb <- ifelse(month(db$DATE) == 2, 1, 0) # nolint
db$Mar <- ifelse(month(db$DATE) == 3, 1, 0) # nolint
db$Apr <- ifelse(month(db$DATE) == 4, 1, 0) # nolint
db$May <- ifelse(month(db$DATE) == 5, 1, 0) # nolint
db$Jun <- ifelse(month(db$DATE) == 6, 1, 0) # nolint
db$Jul <- ifelse(month(db$DATE) == 7, 1, 0) # nolint
db$Aug <- ifelse(month(db$DATE) == 8, 1, 0) # nolint
db$Sep <- ifelse(month(db$DATE) == 9, 1, 0) # nolint
db$Oct <- ifelse(month(db$DATE) == 10, 1, 0) # nolint
db$Nov <- ifelse(month(db$DATE) == 11, 1, 0) # nolint

# Eviews code
# series Jan = @month=1
# series Feb = @month=2
# series Mar = @month=3
# series Apr = @month=4
# series May = @month=5
# series Jun = @month=6
# series Jul = @month=7
# series Aug = @month=8
# series Sep = @month=9
# series Oct = @month=10
# series Nov = @month=11
```

## 2(a) (4 marks)

```{r, echo=FALSE}
lmObj <- lm( # nolint
    HOUSTNSA ~ Jan + Feb + Mar + Apr +
        May + Jun + Jul + Aug + Sep + Oct + Nov,
    data = db
)
```

<!-- Analysis -->
\begin{dmath}
    \widehat{HOUSTNSA} =      \underset{(4.196)}{92.871}
                        \ - \ \underset{(5.911)}{4.592}\ Jan
                        \ - \ \underset{(5.911)}{1.935}\ Feb
                        \ + \ \underset{(5.934)}{26.184}\ Mar
                        \ + \ \underset{(5.934)}{41.452}\ Apr
                        \ + \ \underset{(5.934)}{46.786}\ May
                        \ + \ \underset{(5.934)}{46.263}\ Jun
                        \ + \ \underset{(5.934)}{40.937}\ Jul
                        \ + \ \underset{(5.934)}{38.714}\ Aug
                        \ + \ \underset{(5.934)}{32.252}\ Sep
                        \ + \ \underset{(5.934)}{36.170}\ Oct
                        \ + \ \underset{(5.934)}{15.600}\ Nov
\end{dmath}

The above linear regression estimates the US monthly 'housing starts' based on the month that is being modelled.
The intercept $\beta_0 = 92.781$ is the estimated 'housing starts', on average, in US for the month of December.
The variables in the linear regression are seasonal dummies which mean they only take a binary value (0 or 1). 
The $\beta$ values for the seasonal dummies are the average change in the 'housing starts' relative to the month December.
- January, on average, has 4.592 less 'housing starts' than the month of December, i.e. NUMBER of 'housing starts in January.

## 2(b) (4 marks)

```{r, eval=FALSE, echo=FALSE}
db2 <- read.csv2(
    file = "Assignment 2/Data/HOUSTNSA.csv",
    sep = ","
)

db2 <- db2 %>%
    as_tibble() %>%
    mutate(
        DATE = yearmonth(DATE),
        HOUSTNSA = as.numeric(HOUSTNSA)
    ) %>%
    as_tsibble()

db2$Feb <- ifelse(month(db2$DATE) == 2, 1, 0) # nolint
db2$Mar <- ifelse(month(db2$DATE) == 3, 1, 0) # nolint
db2$Apr <- ifelse(month(db2$DATE) == 4, 1, 0) # nolint
db2$May <- ifelse(month(db2$DATE) == 5, 1, 0) # nolint
db2$Jun <- ifelse(month(db2$DATE) == 6, 1, 0) # nolint
db2$Jul <- ifelse(month(db2$DATE) == 7, 1, 0) # nolint
db2$Aug <- ifelse(month(db2$DATE) == 8, 1, 0) # nolint
db2$Sep <- ifelse(month(db2$DATE) == 9, 1, 0) # nolint
db2$Oct <- ifelse(month(db2$DATE) == 10, 1, 0) # nolint
db2$Nov <- ifelse(month(db2$DATE) == 11, 1, 0) # nolint
db2$Dec <- ifelse(month(db2$DATE) == 12, 1, 0) # nolint

lmObj2 <- lm( # nolint
    HOUSTNSA ~ Feb + Mar + Apr + May + Jun +
        Jul + Aug + Sep + Oct + Nov + Dec,
    data = db2
)
```

<!-- Analysis -->
### Steps

In order to formulate the linear regression, first we need to determine the intercept:
From equation 1 we can determine the values of each month because of the dummy variables.
$92.871 - 4.592  = c \rightarrow c = 88.280$, where the LHS is the month of Jan from calculated from equation 1. 

Next we need to determine the $\beta$ values for Feb - Dec. Since we know the intercept for the new equation, we can substitute it in.
\begin{align*}
    92.871 + 1.935  &= 88.280 + \beta_2 \ Feb  \\ 
                    &\rightarrow \ \beta_2 = 2.656 \\
                    \\
    92.871 + 26.184 &= 88.280 + \beta_3 \ Mar  \\ 
                    &\rightarrow \ \beta_3 = 30.776 \\
                    \\
    92.871 + 41.452 &= 88.280 + \beta_4 \ Apr  \\ 
                    &\rightarrow \ \beta_4 = 46.044 \\
                    \\
    92.871 + 46.786 &= 88.280 + \beta_5 \ May  \\ 
                    &\rightarrow \ \beta_5 = 51.377 \\
                    \\
    92.871 + 46.263 &= 88.280 + \beta_6 \ Jun  \\ 
                    &\rightarrow \ \beta_6 = 50.855 \\
                    \\
    92.871 + 40.937 &= 88.280 + \beta_7 \ Jul  \\ 
                    &\rightarrow \ \beta_7 = 45.528 \\
                    \\
    92.871 + 38.714 &= 88.280 + \beta_8 \ Aug  \\ 
                    &\rightarrow \ \beta_8 = 43.306 \\
                    \\
    92.871 + 32.252 &= 88.280 + \beta_9 \ Sep  \\ 
                    &\rightarrow \ \beta_9 = 36.844 \\
                    \\
    92.871 + 36.170 &= 88.280 + \beta_{10} \ Oct \\ 
                    &\rightarrow \ \beta_{10} = 40.762 \\
                    \\
    92.871 + 15.600 &= 88.280 + \beta_{11} \ Nov \\ 
                    &\rightarrow \ \beta_{11} = 20.192 \\
                    \\
    92.871          &= 88.280 + \beta_{12} \ Dec \\ 
                    &\rightarrow \ \beta_{12} = 4.592 \\
                    \\
\end{align*}

\begin{dmath}
    \widehat{HOUSTNSA} =      88.280
                        \ + \ 2.656 \ Feb
                        \ + \ 30.776\ Mar
                        \ + \ 46.044\ Apr
                        \ + \ 51.377\ May
                        \ + \ 50.855\ Jun
                        \ + \ 45.528\ Jul
                        \ + \ 43.306\ Aug
                        \ + \ 36.844\ Sep
                        \ + \ 40.762\ Oct
                        \ + \ 20.192\ Nov
                        \ + \ 4.592 \ Dec
\end{dmath}


## 2(c) (6 marks)

\begin {equation}
    \widehat{HOUSTNSA} = \underset{(1.377)}{119.3}
\end {equation}

```{r echo=FALSE}
lmObj3 <- lm(HOUSTNSA ~ 1, data = db)
# lmObj3 %>% summary()
acf(
    lmObj3$residuals,
    type = "correlation",
    lag.max = 36,
    main = "Residuals ACF plot",
    sub = "EQ(3)"
)
pacf(
    lmObj3$residuals,
    lag.max = 36,
    main = "Residuals PACF plot",
    sub = "EQ(3)"
)
```

<!-- Analysis -->
The residual ACF plot for the linear model EQ(3) shows a few things.
Firstly, each non-seasonal lag (lag $\ne \{12, 24, 36\}$) have a large positive spike which indicates the existence of a trend.
Secondly, the seasonal lags have large positive spikes which indicates that there is also seasonality in the data. 
So we can attribute the gradual decrease in the lag values is because of trend while the scallop pattern is due to the seasonality. 
As a result of the trend and seasonality it can safely be said that there is no stationarity in the data and thus implying that the error term is not white noise.

```{r, echo = FALSE}
acf(
    lmObj$residuals,
    type = "correlation",
    lag.max = 36,
    main = "Residuals ACF plot",
    sub = "EQ(1)"
)
pacf(
    lmObj$residuals,
    lag.max = 36,
    main = "Residuals PACF plot",
    sub = "EQ(1)"
)
```

<!-- Analysis -->
The residual ACF plot for the linear model EQ(1) shows a significant difference compared to the residual ACF plot for the linear model EQ(3). 
The linear model EQ(1) has no seasonality in the residual ACF plot since the linear model has already captured it. What is remaining is the trend as depicted by decreasing values as the lags increase, showing that the seasonal dummy variables have improved the model. 
Despite the improvement, there is still a trend which means that there is no stationarity in the data and thus implying the error term is not white noise.


## 2(d) (9 marks)

```{r, echo=FALSE}

AR_2_dummies <- db %>% lm(
    formula =
        HOUSTNSA ~ Jan + Feb + Mar + Apr + May + Jun + Jul +
            Aug + Sep + Oct + Nov + lag(HOUSTNSA, n = 1) + lag(HOUSTNSA, n = 2)
)
AR_2_no_dummies <- db %>% lm(
    formula = HOUSTNSA ~ lag(HOUSTNSA, n = 1) + lag(HOUSTNSA, n = 2)
)
# AR_2_dummies %>% summary()
# AR_2_no_dummies %>% summary()
```


\begin{dmath}
    \widehat{HOUSTNSA} =      \underset{(2.165)}{-14.042}
                        \ - \ \underset{(2.003)}{11.014}\ Jan
                        \ - \ \underset{(2.091)}{20.084}\ Feb
                        \ + \ \underset{(2.179)}{47.498}\ Mar
                        \ + \ \underset{(2.652)}{40.081}\ Apr
                        \ + \ \underset{(2.360)}{28.510}\ May
                        \ + \ \underset{(2.198)}{21.153}\ Jun
                        \ + \ \underset{(2.123)}{15.297}\ Jul
                        \ + \ \underset{(2.067)}{17.297}\ Aug
                        \ + \ \underset{(2.095)}{13.490}\ Sep
                        \ + \ \underset{(2.049)}{22.810}\ Oct
                        \ + \ \underset{(2.168)}{0.347}\ Nov
                        \ + \ \underset{(0.036)}{0.775}\ HOUSTNSA_{t-1}
                        \ + \ \underset{(0.036)}{0.177}\ HOUSTNSA_{t-2}
\end{dmath}

```{r, warning = FALSE, error = FALSE}

# level of significance
alpha_1 <- 0.05

# unrestricted model
fit1.UR <- AR_2_dummies
# fit1.UR %>% summary()

# restricted model
fit1.R <- AR_2_no_dummies
# fit1.R %>% summary()

# Sum of squared residuals
SSR1.UR <- sum(resid(fit1.UR)^2)
SSR1.R <- sum(resid(fit1.R)^2)

# degrees of freedom
DF1_num <- df.residual(fit1.R) - df.residual(fit1.UR) # no. of restrictions = 11
DF1_denom <- df.residual(fit1.UR) # degrees of freedom of UR linear model = 742

# test statistic
tstat1 <- ((SSR1.R - SSR1.UR) / DF1_num) / ((SSR1.UR) / DF1_denom)
# ~ F(11, 746)

# critical value
fcrit1 <- qf(1 - alpha_1 / 2, DF1_num, DF1_denom)

# decision
# tstat1 > fcrit1
```
<!-- H_0 &: \beta_1 = \beta_2 = \beta_3 = \beta_4 = \beta_5 = \beta_6 = \beta_7 = \beta_8 = \beta_9 = \beta_{10} = \beta_{11} = 0 \\ -->
\begin{align*}
    H_0 &: \underset{i \in \{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11\}}{\forall} \beta_i = 0 \\
    H_1 &: \underset{i \in \{1, 2, 3, 4, 5\}}{\exists} {\beta_i} \neq 0 \text { at least one regressor coef is zero}\\
    \text {Significance Level} &: \alpha = 0.05 \\
    \text {Unresticted Model} &: \widehat{HOUSTNSA} = \underset{(2.165)}{-14.042}
                                                    \ - \ \underset{(2.003)}{11.014}\ Jan
                                                    \ - \ \underset{(2.091)}{20.084}\ Feb\\
                                                    &\ + \ \underset{(2.179)}{47.498}\ Mar
                                                    \ + \ \underset{(2.652)}{40.081}\ Apr
                                                    \ + \ \underset{(2.360)}{28.510}\ May\\
                                                    &\ + \ \underset{(2.198)}{21.153}\ Jun
                                                    \ + \ \underset{(2.123)}{15.297}\ Jul
                                                    \ + \ \underset{(2.067)}{17.297}\ Aug\\
                                                    &\ + \ \underset{(2.095)}{13.490}\ Sep
                                                    \ + \ \underset{(2.049)}{22.810}\ Oct
                                                    \ + \ \underset{(2.168)}{0.347}\ Nov\\
                                                    &\ + \ \underset{(0.036)}{0.775}\ HOUSTNSA_{t-1}
                                                    \ + \ \underset{(0.036)}{0.177}\ HOUSTNSA_{t-2} \\
    \text {Resticted Model} &: \widehat{HOUSTNSA} = \underset{(1.970)}{14.598} 
                                                    \ + \ \underset{(0.035)}{1.110} \ HOUSTNSA_{t-1}
                                                    \ - \ \underset{(0.035)}{0.232} \ HOUSTNSA_{t-2}\\
    \text {Test stat and null dist} &: \frac{(SSR_R - SSR_{UR})}{SSR_{UR}} \frac{(n-k-1)}{q} \sim F_{(q, n-k-1)} = F_{11, 742} \\
    F_{calc} &= `r tstat1` \\
    F_{crit} &= `r fcrit1` \\
    \text {Decision rule} &: \text {reject $H_0$ if $F_{calc} > F_{crit}$} \\
    \text {Decision} &: \text {Since `r tstat1` > `r fcrit1`, reject $H_0$} \\
\end{align*}

In conclusion, at 0.05 level of significance, we reject the null hypothesis that the seasonal dummies (Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct) are jointly insignificant in effecting the 'Housing Starts' in favour of the alternative hypothesis that at least one of these variables are significant. 

## 2(e) (8 marks)

\begin{dmath}
    \widehat{HOUSTNSA} =      \underset{(2.264)}{-1.503}
                        \ + \ \underset{(1.590)}{17.299}\ Q1
                        \ + \ \underset{(1.772)}{16.273}\ Q2
                        \ + \ \underset{(1.534)}{6.685}\ Q3
                        \ + \ \underset{(0.040)}{1.007}\ HOUSTNSA_{t-1}
                        \ - \ \underset{(0.039)}{0.079}\ HOUSTNSA_{t-2}
\end{dmath}

### Monthly Model (Unresticted):
\begin{dmath}
    LHS =
                        \beta_0
                        \ + \ \beta_1 \ Jan 
                        \ + \ \beta_2 \ Feb 
                        \ + \ \beta_3 \ Mar 
                        \ + \ \beta_4 \ Apr 
                        \ + \ \beta_5 \ May 
                        \ + \ \beta_6 \ Jun 
                        \ + \ \beta_7 \ Jul 
                        \ + \ \beta_8 \ Aug 
                        \ + \ \beta_9 \ Sep 
                        \ + \ \beta_{10} \ Oct 
                        \ + \ \beta_{11} \ Nov 
                        \ + \ \beta_{13} \ HOUSTNSA_{t-1}
                        \ + \ \beta_{14} \ HOUSTNSA_{t-2}
\end{dmath}

### Quarterly Model:
\begin{dmath}
    RHS =
                        \alpha_0
                        \ + \ \alpha_1 \ Q1 
                        \ + \ \alpha_2 \ Q2 
                        \ + \ \alpha_3 \ Q3  
                        \ + \ \alpha_4 \ HOUSTNSA_{t-1}
                        \ + \ \alpha_5 \ HOUSTNSA_{t-2}
\end{dmath}

### LHS == RHS
\begin{align*}
    \widehat{HOUSTNSA} &=
            \beta_0
            \ + \ \beta_1 \ Jan 
            \ + \ \beta_2 \ Feb 
            \ + \ \beta_3 \ Mar
            \ + \ \beta_4 \ Apr 
            \ + \ \beta_5 \ May 
            \ + \ \beta_6 \ Jun \\
            &\ + \ \beta_7 \ Jul 
            \ + \ \beta_8 \ Aug 
            \ + \ \beta_9 \ Sep
            \ + \ \beta_{10} \ Oct 
            \ + \ \beta_{11} \ Nov\\ 
            &\ + \ \beta_{13} \ HOUSTNSA_{t-1}
            \ + \ \beta_{14} \ HOUSTNSA_{t-2}\\
    \widehat{HOUSTNSA} &=
                        \alpha_0
                        \ + \ \alpha_1 \ Q1 
                        \ + \ \alpha_2 \ Q2 
                        \ + \ \alpha_3 \ Q3 
                        \ + \ \alpha_4 \ HOUSTNSA_{t-1}
                        \ + \ \alpha_5 \ HOUSTNSA_{t-2}\\
\end{align*}


\begin{align*}
    \alpha_0 &= \beta_0 + \beta_{10} + \beta_{11}\\
    \alpha_1 &= \beta_1 + \beta_2 + \beta_3\\
    \alpha_2 &= \beta_4 + \beta_5 + \beta_6\\
    \alpha_3 &= \beta_7 + \beta_8 + \beta_9\\
    \alpha_4 &= \beta_{13}\\
    \alpha_5 &= \beta_{14}\\
\end{align*}

### Quarterly Model (Restricted):
\begin{dmath}
    RHS =
                        \beta_0 + \beta_{10} + \beta_{11}
                        \ + \ (\beta_1 + \beta_2 + \beta_3) \ Q1 
                        \ + \ (\beta_4 + \beta_5 + \beta_6) \ Q2 
                        \ + \ (\beta_7 + \beta_8 + \beta_9) \ Q3
                        \ + \ \beta_{13} \ HOUSTNSA_{t-1}
                        \ + \ \beta_{14} \ HOUSTNSA_{t-2}
\end{dmath}

```{r, echo=FALSE}
# q_db <- tibble(
#     Date = db$DATE,
#     HOUSTNSA = db$HOUSTNSA,
#     Q1 = ifelse(quarter(db$DATE) == 1, 1, 0),
#     Q2 = ifelse(quarter(db$DATE) == 2, 1, 0),
#     Q3 = ifelse(quarter(db$DATE) == 3, 1, 0)
# )
# q_db %>% head()
```

```{r}
alpha_1 <- (db$Jan + db$Feb + db$Mar)
alpha_2 <- (db$Apr + db$May + db$Jun)
alpha_3 <- (db$Jul + db$Aug + db$Sep)

qAR_2 <- db %>% lm(
    formula =
        HOUSTNSA ~ alpha_1 + alpha_2 + alpha_3 + lag(HOUSTNSA, n = 1) + lag(HOUSTNSA, n = 2)
)
# qAR_2 %>% summary()
```


```{r}
alpha_1 <- 0.05

# unrestricted model
fit2.UR <- AR_2_dummies
# fit1.UR %>% summary()

# restricted model
fit2.R <- qAR_2
# fit1.R %>% summary()

# Sum of squared residuals
SSR2.UR <- sum(resid(fit2.UR)^2)
SSR2.R <- sum(resid(fit2.R)^2)

# degrees of freedom
# DF2_num <- df.residual(fit2.R) - df.residual(fit2.UR) # no. of restrictions = 3
# DF2_denom <- df.residual(fit2.UR) # degrees of freedom of UR linear model = 742

# test statistic
tstat2 <- ((SSR2.R - SSR2.UR) / 3) / ((SSR2.UR) / (758 - 5 - 1))
# ~ F(3, 752)

# critical value
fcrit2 <- qf(1 - alpha_1 / 2, 3, 758 - 5 - 1)
# qf(1 - alpha_1 / 2, 3, 120)
```

\begin{align*}
    H_0 &: \underset{i \in \{0, 1, 2, 3\}}{\forall} \alpha_i = 0 \\
    H_1 &: \underset{i \in \{0, 1, 2, 3\}}{\exists} {\alpha_i} \neq 0 \text { at least one regressor coef is zero}\\
    \text {Test stat and null dist} &: \frac{(SSR_R - SSR_{UR})}{SSR_{UR}} \frac{(n-k-1)}{q} \sim F_{(q, n-k-1)} = F_{3, 752} \\
    F_{calc} &= `r tstat2` \\
    F_{crit} &= `r fcrit2` \\
    \text {Decision rule} &: \text {reject $H_0$ if $F_{calc} > F_{crit}$} \\
    \text {Decision} &: \text {Since `r tstat2` > `r fcrit2`, reject $H_0$} \\
\end{align*}

In conclusion, at 0.05 level of significance, we reject the null hypothesis that there is only quarterly seasonality in the AR(2) model in favour of the alternative hypothesis that there may also be monthly seasonality in the AR(2) model. 